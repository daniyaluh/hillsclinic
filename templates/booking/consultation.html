{% extends "base.html" %}
{% load static %}

{% block title %}{{ page_title }} - Hills Clinic{% endblock %}

{% block content %}
<div x-data="{ 
    step: {% if form.errors %}1{% else %}1{% endif %}, 
    selectedTimezone: Intl.DateTimeFormat().resolvedOptions().timeZone || 'Asia/Karachi',
    consultationType: '{{ form.consultation_type.value|default:"video" }}',
    appointmentType: '{{ form.appointment_type.value|default:"consultation" }}'
}">
    
    <!-- Hero Section -->
    <section class="bg-gradient-to-br from-stone-900 via-stone-800 to-stone-900 text-white py-16">
        <div class="container mx-auto px-4 text-center">
            <h1 class="text-4xl md:text-5xl font-serif font-bold mb-4">Book Your Consultation</h1>
            <p class="text-xl text-stone-300 max-w-2xl mx-auto">Take the first step towards your transformation. Speak with our expert medical team.</p>
            <p class="mt-6 text-lg text-white/90">Consultation Fee: <span class="font-bold text-2xl text-amber-400">$10</span> <span class="text-stone-400 text-sm">(Payable after booking)</span></p>
        </div>
    </section>
    
    <!-- Progress Steps -->
    <section class="bg-white py-8 border-b border-stone-200">
        <div class="container mx-auto px-4">
            <div class="max-w-3xl mx-auto">
                <div class="flex justify-between items-center">
                    <div class="flex items-center">
                        <div :class="step >= 1 ? 'bg-amber-600 text-white' : 'bg-stone-200 text-stone-500'" class="w-10 h-10 rounded-full flex items-center justify-center font-bold transition-colors">1</div>
                        <span class="ml-2 text-sm font-medium hidden sm:inline" :class="step >= 1 ? 'text-amber-700' : 'text-stone-500'">Personal Info</span>
                    </div>
                    <div class="flex-1 mx-4 h-1 bg-stone-200 rounded-full overflow-hidden">
                        <div class="h-full bg-amber-600 rounded-full transition-all duration-300" :style="step >= 2 ? 'width: 100%' : 'width: 0%'"></div>
                    </div>
                    <div class="flex items-center">
                        <div :class="step >= 2 ? 'bg-amber-600 text-white' : 'bg-stone-200 text-stone-500'" class="w-10 h-10 rounded-full flex items-center justify-center font-bold transition-colors">2</div>
                        <span class="ml-2 text-sm font-medium hidden sm:inline" :class="step >= 2 ? 'text-amber-700' : 'text-stone-500'">Consultation</span>
                    </div>
                    <div class="flex-1 mx-4 h-1 bg-stone-200 rounded-full overflow-hidden">
                        <div class="h-full bg-amber-600 rounded-full transition-all duration-300" :style="step >= 3 ? 'width: 100%' : 'width: 0%'"></div>
                    </div>
                    <div class="flex items-center">
                        <div :class="step >= 3 ? 'bg-amber-600 text-white' : 'bg-stone-200 text-stone-500'" class="w-10 h-10 rounded-full flex items-center justify-center font-bold transition-colors">3</div>
                        <span class="ml-2 text-sm font-medium hidden sm:inline" :class="step >= 3 ? 'text-amber-700' : 'text-stone-500'">Confirm</span>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Form Section -->
    <section class="py-16 bg-stone-50">
        <div class="container mx-auto px-4">
            <div class="max-w-3xl mx-auto">
                <form method="post" action="{% url 'booking:consultation' %}" class="bg-white rounded-3xl shadow-sm ring-1 ring-stone-200 p-8 md:p-10">
                    {% csrf_token %}
                    
                    <!-- Form Errors -->
                    {% if form.errors %}
                    <div class="mb-6 p-4 bg-red-50 border border-red-200 rounded-2xl">
                        <h3 class="text-red-800 font-semibold mb-2">Please correct the following errors:</h3>
                        <ul class="list-disc list-inside text-red-700 text-sm">
                            {% for field in form %}
                                {% for error in field.errors %}
                                <li><strong>{{ field.label }}:</strong> {{ error }}</li>
                                {% endfor %}
                            {% endfor %}
                            {% for error in form.non_field_errors %}
                            <li>{{ error }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}
                    
                    <!-- Step 1: Personal Information -->
                    <div x-show="step === 1" x-transition>
                        <h2 class="text-2xl font-serif font-bold text-stone-900 mb-6">What type of consultation do you need?</h2>
                        
                        <!-- Appointment Type Selection -->
                        <div class="mb-8">
                            <div class="grid sm:grid-cols-2 gap-4">
                                <label class="flex items-start p-4 border-2 rounded-2xl cursor-pointer hover:border-amber-500 transition-colors" 
                                       :class="appointmentType === 'consultation' ? 'border-amber-500 bg-amber-50' : 'border-stone-200'">
                                    <input type="radio" name="appointment_type" value="consultation" x-model="appointmentType" class="sr-only">
                                    <div class="w-5 h-5 border-2 rounded-full mr-3 mt-0.5 flex-shrink-0 flex items-center justify-center" 
                                         :class="appointmentType === 'consultation' ? 'border-amber-600' : 'border-stone-300'">
                                        <div class="w-3 h-3 bg-amber-600 rounded-full" x-show="appointmentType === 'consultation'"></div>
                                    </div>
                                    <div>
                                        <span class="font-semibold text-stone-900">First Consultation</span>
                                        <p class="text-sm text-stone-500 mt-1">I'm a new patient inquiring about limb lengthening</p>
                                    </div>
                                </label>
                                
                                <label class="flex items-start p-4 border-2 rounded-2xl cursor-pointer hover:border-amber-500 transition-colors" 
                                       :class="appointmentType === 'follow_up' ? 'border-amber-500 bg-amber-50' : 'border-stone-200'">
                                    <input type="radio" name="appointment_type" value="follow_up" x-model="appointmentType" class="sr-only">
                                    <div class="w-5 h-5 border-2 rounded-full mr-3 mt-0.5 flex-shrink-0 flex items-center justify-center" 
                                         :class="appointmentType === 'follow_up' ? 'border-amber-600' : 'border-stone-300'">
                                        <div class="w-3 h-3 bg-amber-600 rounded-full" x-show="appointmentType === 'follow_up'"></div>
                                    </div>
                                    <div>
                                        <span class="font-semibold text-stone-900">Follow-up</span>
                                        <p class="text-sm text-stone-500 mt-1">I've consulted before and need to follow up</p>
                                    </div>
                                </label>
                                
                                <label class="flex items-start p-4 border-2 rounded-2xl cursor-pointer hover:border-amber-500 transition-colors" 
                                       :class="appointmentType === 'pre_op' ? 'border-amber-500 bg-amber-50' : 'border-stone-200'">
                                    <input type="radio" name="appointment_type" value="pre_op" x-model="appointmentType" class="sr-only">
                                    <div class="w-5 h-5 border-2 rounded-full mr-3 mt-0.5 flex-shrink-0 flex items-center justify-center" 
                                         :class="appointmentType === 'pre_op' ? 'border-amber-600' : 'border-stone-300'">
                                        <div class="w-3 h-3 bg-amber-600 rounded-full" x-show="appointmentType === 'pre_op'"></div>
                                    </div>
                                    <div>
                                        <span class="font-semibold text-stone-900">Pre-operative</span>
                                        <p class="text-sm text-stone-500 mt-1">Surgery preparation discussion</p>
                                    </div>
                                </label>
                                
                                <label class="flex items-start p-4 border-2 rounded-2xl cursor-pointer hover:border-amber-500 transition-colors" 
                                       :class="appointmentType === 'post_op' ? 'border-amber-500 bg-amber-50' : 'border-stone-200'">
                                    <input type="radio" name="appointment_type" value="post_op" x-model="appointmentType" class="sr-only">
                                    <div class="w-5 h-5 border-2 rounded-full mr-3 mt-0.5 flex-shrink-0 flex items-center justify-center" 
                                         :class="appointmentType === 'post_op' ? 'border-amber-600' : 'border-stone-300'">
                                        <div class="w-3 h-3 bg-amber-600 rounded-full" x-show="appointmentType === 'post_op'"></div>
                                    </div>
                                    <div>
                                        <span class="font-semibold text-stone-900">Post-operative</span>
                                        <p class="text-sm text-stone-500 mt-1">Recovery check-in after surgery</p>
                                    </div>
                                </label>
                            </div>
                        </div>
                        
                        <h3 class="text-xl font-semibold mb-4 text-stone-700">Your Information</h3>
                        
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-stone-700 mb-2">Full Name *</label>
                                {{ form.full_name }}
                                {% if form.full_name.errors %}
                                <p class="mt-1 text-sm text-red-600">{{ form.full_name.errors.0 }}</p>
                                {% endif %}
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-stone-700 mb-2">Email Address *</label>
                                {{ form.email }}
                                {% if form.email.errors %}
                                <p class="mt-1 text-sm text-red-600">{{ form.email.errors.0 }}</p>
                                {% endif %}
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-stone-700 mb-2">Phone Number *</label>
                                {{ form.phone }}
                                {% if form.phone.errors %}
                                <p class="mt-1 text-sm text-red-600">{{ form.phone.errors.0 }}</p>
                                {% endif %}
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-stone-700 mb-2">Country *</label>
                                {{ form.country }}
                                {% if form.country.errors %}
                                <p class="mt-1 text-sm text-red-600">{{ form.country.errors.0 }}</p>
                                {% endif %}
                            </div>
                            
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-stone-700 mb-2">Your Timezone *</label>
                                {{ form.patient_timezone }}
                                <p class="mt-1 text-sm text-stone-500">We'll schedule the consultation in your local time.</p>
                            </div>
                        </div>
                        
                        <div class="mt-8 flex justify-end">
                            <button type="button" @click="step = 2" class="inline-flex items-center px-8 py-3 bg-amber-600 text-white font-semibold rounded-full hover:bg-amber-700 transition-all shadow-lg shadow-amber-600/25">
                                Next Step
                                <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Step 2: Consultation Details -->
                    <div x-show="step === 2" x-transition>
                        <h2 class="text-2xl font-serif font-bold text-stone-900 mb-6">Consultation Details</h2>
                        
                        <div class="space-y-6">
                            <div>
                                <label class="block text-sm font-medium text-stone-700 mb-3">How would you like to consult? *</label>
                                <div class="space-y-3">
                                    <label class="flex items-center p-4 border-2 rounded-2xl cursor-pointer hover:border-amber-500 transition-colors" :class="consultationType === 'video' ? 'border-amber-500 bg-amber-50' : 'border-stone-200'">
                                        <input type="radio" name="consultation_type" value="video" x-model="consultationType" class="sr-only" checked>
                                        <div class="w-5 h-5 border-2 rounded-full mr-3 flex items-center justify-center" :class="consultationType === 'video' ? 'border-amber-600' : 'border-stone-300'">
                                            <div class="w-3 h-3 bg-amber-600 rounded-full" x-show="consultationType === 'video'"></div>
                                        </div>
                                        <div>
                                            <span class="font-medium text-stone-900">Video Call (Recommended)</span>
                                            <p class="text-sm text-stone-500">Zoom or WhatsApp video call</p>
                                        </div>
                                    </label>
                                    <label class="flex items-center p-4 border-2 rounded-2xl cursor-pointer hover:border-amber-500 transition-colors" :class="consultationType === 'phone' ? 'border-amber-500 bg-amber-50' : 'border-stone-200'">
                                        <input type="radio" name="consultation_type" value="phone" x-model="consultationType" class="sr-only">
                                        <div class="w-5 h-5 border-2 rounded-full mr-3 flex items-center justify-center" :class="consultationType === 'phone' ? 'border-amber-600' : 'border-stone-300'">
                                            <div class="w-3 h-3 bg-amber-600 rounded-full" x-show="consultationType === 'phone'"></div>
                                        </div>
                                        <div>
                                            <span class="font-medium text-stone-900">Phone Call</span>
                                            <p class="text-sm text-stone-500">Traditional phone consultation</p>
                                        </div>
                                    </label>
                                    <label class="flex items-center p-4 border-2 rounded-2xl cursor-pointer hover:border-amber-500 transition-colors" :class="consultationType === 'whatsapp' ? 'border-amber-500 bg-amber-50' : 'border-stone-200'">
                                        <input type="radio" name="consultation_type" value="whatsapp" x-model="consultationType" class="sr-only">
                                        <div class="w-5 h-5 border-2 rounded-full mr-3 flex items-center justify-center" :class="consultationType === 'whatsapp' ? 'border-amber-600' : 'border-stone-300'">
                                            <div class="w-3 h-3 bg-amber-600 rounded-full" x-show="consultationType === 'whatsapp'"></div>
                                        </div>
                                        <div>
                                            <span class="font-medium text-stone-900">WhatsApp Chat</span>
                                            <p class="text-sm text-stone-500">Text-based consultation</p>
                                        </div>
                                    </label>
                                    <label class="flex items-center p-4 border-2 rounded-2xl cursor-pointer hover:border-amber-500 transition-colors" :class="consultationType === 'in_clinic' ? 'border-amber-500 bg-amber-50' : 'border-stone-200'">
                                        <input type="radio" name="consultation_type" value="in_clinic" x-model="consultationType" class="sr-only">
                                        <div class="w-5 h-5 border-2 rounded-full mr-3 flex items-center justify-center" :class="consultationType === 'in_clinic' ? 'border-amber-600' : 'border-stone-300'">
                                            <div class="w-3 h-3 bg-amber-600 rounded-full" x-show="consultationType === 'in_clinic'"></div>
                                        </div>
                                        <div class="flex-1">
                                            <span class="font-medium text-stone-900">In-Person at Clinic</span>
                                            <p class="text-sm text-stone-500">Visit our clinic in Karachi, Pakistan</p>
                                        </div>
                                        <span class="px-3 py-1 bg-amber-100 text-amber-700 text-xs font-semibold rounded-full">Premium</span>
                                    </label>
                                </div>
                                
                                <!-- In-Clinic Notice -->
                                <div x-show="consultationType === 'in_clinic'" x-transition class="mt-4 p-4 bg-amber-50 border border-amber-200 rounded-2xl">
                                    <div class="flex items-start gap-3">
                                        <svg class="w-5 h-5 text-amber-600 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                                        </svg>
                                        <div>
                                            <p class="font-semibold text-amber-800">Clinic Location</p>
                                            <p class="text-sm text-amber-700 mt-1">Hills Limb Lengthening Clinic<br>Karachi, Pakistan</p>
                                            <p class="text-sm text-amber-600 mt-2">Our team will send you the exact address and directions upon confirmation.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="grid md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-stone-700 mb-2">Current Height</label>
                                    {{ form.current_height }}
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-stone-700 mb-2">Desired Height Gain *</label>
                                    {{ form.desired_height_gain }}
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-stone-700 mb-2">Procedure of Interest *</label>
                                {{ form.procedure_interest }}
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-stone-700 mb-2">Medical Conditions (Optional)</label>
                                {{ form.medical_conditions }}
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-stone-700 mb-2">Questions for Our Team</label>
                                {{ form.questions }}
                            </div>
                        </div>
                        
                        <div class="mt-8 flex justify-between">
                            <button type="button" @click="step = 1" class="inline-flex items-center px-6 py-3 border-2 border-stone-300 text-stone-700 font-medium rounded-full hover:border-stone-400 transition-colors">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                                </svg>
                                Back
                            </button>
                            <button type="button" @click="step = 3" class="inline-flex items-center px-8 py-3 bg-amber-600 text-white font-semibold rounded-full hover:bg-amber-700 transition-all shadow-lg shadow-amber-600/25">
                                Review & Submit
                                <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Step 3: Confirmation -->
                    <div x-show="step === 3" x-transition>
                        <h2 class="text-2xl font-serif font-bold text-stone-900 mb-6">Confirm Your Booking</h2>
                        
                        <div class="bg-gradient-to-br from-amber-50 to-orange-50 rounded-2xl p-6 mb-8 ring-1 ring-amber-200">
                            <h3 class="font-semibold text-amber-800 mb-4">What happens next?</h3>
                            <ol class="space-y-4 text-amber-700">
                                <li class="flex items-start">
                                    <span class="w-7 h-7 bg-amber-600 text-white rounded-full flex items-center justify-center text-sm font-bold mr-3 mt-0.5 flex-shrink-0">1</span>
                                    <span>Submit your request and pay the $10 consultation fee</span>
                                </li>
                                <li class="flex items-start">
                                    <span class="w-7 h-7 bg-amber-600 text-white rounded-full flex items-center justify-center text-sm font-bold mr-3 mt-0.5 flex-shrink-0">2</span>
                                    <span>Our staff verifies your payment</span>
                                </li>
                                <li class="flex items-start">
                                    <span class="w-7 h-7 bg-amber-600 text-white rounded-full flex items-center justify-center text-sm font-bold mr-3 mt-0.5 flex-shrink-0">3</span>
                                    <span>The doctor assigns a convenient time slot for your consultation</span>
                                </li>
                                <li class="flex items-start">
                                    <span class="w-7 h-7 bg-amber-600 text-white rounded-full flex items-center justify-center text-sm font-bold mr-3 mt-0.5 flex-shrink-0">4</span>
                                    <span>You receive a confirmation email with your appointment details</span>
                                </li>
                            </ol>
                        </div>
                        
                        <div class="space-y-5 mb-8">
                            <div>
                                <label class="block text-sm font-medium text-stone-700 mb-2">How did you hear about us?</label>
                                {{ form.referral_source }}
                            </div>
                            
                            <div class="flex items-start p-4 bg-stone-50 rounded-2xl">
                                {{ form.privacy_consent }}
                                <label class="ml-3 text-sm text-stone-600">
                                    I agree to the <a href="/privacy-policy/" class="text-amber-700 hover:text-amber-800 font-medium">Privacy Policy</a> and consent to Hills Clinic contacting me regarding my consultation. *
                                </label>
                            </div>
                            {% if form.privacy_consent.errors %}
                            <p class="text-sm text-red-600">{{ form.privacy_consent.errors.0 }}</p>
                            {% endif %}
                            
                            <div class="flex items-start p-4 bg-stone-50 rounded-2xl">
                                {{ form.marketing_consent }}
                                <label class="ml-3 text-sm text-stone-600">
                                    I'd like to receive updates, news, and special offers from Hills Clinic. (Optional)
                                </label>
                            </div>
                        </div>
                        
                        <div class="flex justify-between">
                            <button type="button" @click="step = 2" class="inline-flex items-center px-6 py-3 border-2 border-stone-300 text-stone-700 font-medium rounded-full hover:border-stone-400 transition-colors">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                                </svg>
                                Back
                            </button>
                            <button type="submit" class="inline-flex items-center px-10 py-3 bg-amber-600 text-white font-semibold rounded-full hover:bg-amber-700 transition-all shadow-lg shadow-amber-600/25">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                </svg>
                                Submit Booking Request
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </section>
    
    <!-- Trust Indicators -->
    <section class="py-16 bg-white">
        <div class="container mx-auto px-4">
            <div class="grid md:grid-cols-3 gap-8 max-w-4xl mx-auto text-center">
                <div class="p-6">
                    <div class="w-16 h-16 bg-emerald-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                        </svg>
                    </div>
                    <h3 class="font-bold text-lg text-stone-900 mb-2">100% Confidential</h3>
                    <p class="text-stone-600 text-sm">Your information is secure and protected</p>
                </div>
                <div class="p-6">
                    <div class="w-16 h-16 bg-amber-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </div>
                    <h3 class="font-bold text-lg text-stone-900 mb-2">Affordable Fee</h3>
                    <p class="text-stone-600 text-sm">Only $10 consultation fee</p>
                </div>
                <div class="p-6">
                    <div class="w-16 h-16 bg-stone-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-stone-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8h2a2 2 0 012 2v6a2 2 0 01-2 2h-2v4l-4-4H9a1.994 1.994 0 01-1.414-.586m0 0L11 14h4a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2v4l.586-.586z"/>
                        </svg>
                    </div>
                    <h3 class="font-bold text-lg text-stone-900 mb-2">Expert Medical Team</h3>
                    <p class="text-stone-600 text-sm">Speak with experienced specialists</p>
                </div>
            </div>
        </div>
    </section>
</div>
{% endblock %}
